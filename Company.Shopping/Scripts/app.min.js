!function(t,e,r){"use strict";r.module("products",["ui.router","env"]).config(["$stateProvider","appPath",function(t,e){t.state("products",{url:"/",templateUrl:e+"/scripts/states/products/products.html",controller:"ProductsController",controllerAs:"vm",resolve:{products:["productsService",function(t){return t.getProducts()}]}})}]),r.module("products").controller("ProductsController",["products","basket",function(t,e){var r=this;r.products=t,r.addToBasket=function(t){return e.add(t)},r.isProductInBasket=function(t){return!!e.getProductAmount(t.id)},r.getProductAmount=function(t){return e.getProductAmount(t.id)}}]),r.module("admin",["ui.router","env"]).config(["$stateProvider","appPath",function(t,e){t.state("admin",{url:"/admin",templateUrl:e+"/scripts/states/admin/admin.html",controller:"ProductManagementController",controllerAs:"vm",resolve:{products:["productsService",function(t){return t.getProducts()}]}}).state("create",{parent:"",url:"/create",templateUrl:e+"/scripts/states/admin/create-product.html",controller:"CreateProductController",
controllerAs:"vm"}).state("edit",{parent:"",url:"/edit/:id",templateUrl:e+"/scripts/states/admin/edit-product.html",controller:"EditProductController",controllerAs:"vm",resolve:{product:["$stateParams","productsService",function(t,e){return e.getProduct(t.id)}]}})}]),r.module("admin").controller("EditProductController",["$state","productsService","product",function(t,e,r){function o(){t.go("admin")}var n=this;n.product=r,n.submit=function(t){e.updateProduct(t).then(o)}}]),r.module("admin").controller("CreateProductController",["$state","productsService",function(t,e){function r(){t.go("admin")}var o=this;o.product={},o.submit=function(t){e.createProduct(t).then(r)}}]),r.module("admin").controller("ProductManagementController",["productsService","products",function(t,e){function r(){t.getProducts().then(function(t){o.products=t})}var o=this;o.products=e,o.deleteProduct=function(e){t.deleteProduct(e.id).then(r)}}]),r.module("checkout",["ui.router","env"]).config(["$stateProvider","appPath",function(t,e){t.state("checkout",{
url:"/checkout",templateUrl:e+"/scripts/states/checkout/checkout.html",controller:"CheckoutController",controllerAs:"vm"})}]),r.module("checkout").controller("CheckoutController",["$state","basket","orderService",function(t,e,r){function o(){u.basketProducts=e.getProducts()}function n(){return{firstName:"",lastName:"",firstAddressLine:"",secondAddressLine:"",postCode:"",city:""}}var u=this;u.address=n(),o(),u.getProductAmount=function(t){return e.getProductAmount(t.id)},u.increase=function(t){e.add(t)},u.decrease=function(t){e.remove(t),o()},u.clearBasket=function(){e.clear(),u.address=n()},u.submit=function(){var o=e.getProductAmounts(),n=[];for(var c in o)n.push({productId:c,amount:o[c]});var i={deliveryAddress:u.address,products:n};r.placeOrder(i).then(function(){e.clear(),alert("Your order has been successfully placed."),t.go("products")})},u.getTotal=function(){return e.getTotal()}}]),r.module("rating",["env"]).directive("rating",["appPath",function(t){function e(t){t.stars=[],t.stars.length=t.rating}return{
restrict:"A",templateUrl:t+"/scripts/directives/rating/rating.html",scope:{rating:"="},link:e}}]),r.module("basketStatus",["env","basket"]).directive("basketStatus",["appPath","basket",function(t,e){function r(t,r){t.getTotalItems=function(){return e.count()}}return{restrict:"A",templateUrl:t+"/scripts/directives/basket-status/basket-status.html",scope:!0,replace:!0,link:r}}]),r.module("productsService",["env"]).factory("productsService",["$http","apiPath",function(t,e){function r(){return t.get(e+"/products/").then(function(t){return t.data})}function o(r){return t.get(e+"/products/"+r).then(function(t){return t.data})}function n(r){return t.put(e+"/products/"+r.id,r).then(function(t){return t.data})}function u(r){return t.post(e+"/products/",r).then(function(t){return t.data})}function c(r){return t["delete"](e+"/products/"+r).then(function(t){return t.data})}return{getProducts:r,getProduct:o,updateProduct:n,createProduct:u,deleteProduct:c}}]),r.module("orderService",["env"]).factory("orderService",["$http","apiPath",function(t,e){
function r(r){return t.post(e+"/checkout/",r).then(function(t){return t.data})}return{placeOrder:r}}]),r.module("basket",[]).factory("basket",function(){function t(t){var e=t.id;s[e]?s[e]++:(d.push(t),s[e]=1),a++}function e(t){var e=t.id,r=s[e];r&&(s[e]--,1>=r&&(delete s[e],d=d.filter(function(t){return t.id!==e})),a--)}function r(){d.length=0,s=Object.create(null),a=0}function o(){return a}function n(t){return s[t]||0}function u(){return s}function c(){return d}function i(){var t=0;return d.forEach(function(e){var r=s[e.id];r&&(t+=r*e.price)}),t}var d=[],s=Object.create(null),a=0;return{getProducts:c,add:t,remove:e,clear:r,count:o,getProductAmount:n,getProductAmounts:u,getTotal:i}}),r.module("states",["products","admin","checkout"]),r.module("services",["basket","orderService","productsService"]),r.module("directives",["basketStatus","rating"]),r.module("shopping",["ui.router","env","states","services","directives"]).config(["$urlRouterProvider","$logProvider","debug",function(t,e,r){e.debugEnabled(r),t.otherwise("/");
}]).run(["$log","debug",function(t,e){t.info("Shopping application is running in "+(e?"debug":"production")+" mode.")}]),r.module("shopping").controller("HeaderController",["$state",function(t){var e=this;e.shouldShowBasketStatus=function(){return t.includes("products")}}])}(window,document,window.angular);